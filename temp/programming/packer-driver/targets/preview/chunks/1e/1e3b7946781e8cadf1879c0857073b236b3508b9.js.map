{"version":3,"sources":["file:///Users/zzx/Desktop/mygame/assets/scripts/mjNode.ts"],"names":["_decorator","Component","instantiate","Intersection2D","Prefab","Rect","SpriteAtlas","tween","Vec3","ccclass","property","eventTarget","EventTarget","mjNode","refreshLock","items","curitem","randomIndex","level","allitem","mjItem","node","x","y","start","on","onClickMj","initMj","event","console","log","deleteItems","target","addMjItem","update","deltaTime","getRandomMjIndex","delay","i","call","createMj","refresh","spriteFrame","mjSpriteAtlas","getSpriteFrame","mj","mycard_prefab","parent","mycard","getComponent","push","self","refreshState","length","itemsXJ","j","refreshStateMJ","big","k","mjscrpit1","interaction","getSiblingIndex","node1","node2","pos1","getPosition","pos2","rect1","rect2","rectRect","id","splice","getRandomInt","min","max","Math","floor","random","randomInt","t1","to","position","t2","sequence"],"mappings":"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","sourcesContent":["import { _decorator, BoxCollider2D, Collider, Component, ConfigurableConstraint, EventTouch, Input, input, instantiate, Intersection2D, Node, NodeEventType, Prefab, Rect, resources, Sprite, SpriteAtlas, SpriteFrame, Texture2D, tween, UITransform, Vec2, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\nimport { myEvent } from './myEvent';\nconst eventTarget = new EventTarget();\n\n@ccclass('mjNode')\nexport class mjNode extends Component {\n\n    @property(Prefab)\n    mycard_prefab: Prefab | null = null;\n\n    @property(SpriteAtlas)\n    mjSpriteAtlas: SpriteAtlas = null;\n\n    refreshLock = false;\n    items = [];\n    curitem = 0;        //当前数量\n    randomIndex = 0;    //当前随机牌索引\n    level = 1;          //当前关卡\n    allitem = this.level * 30;        //初始化图片总数量 20*3\n\n    mjItem = [\n        { node: null, x: -294.764, y: -573.635 },\n        { node: null, x: -197.881, y: -573.635 },\n        { node: null, x: -100.211, y: -573.635 },\n        { node: null, x: -2.572, y: -573.635 },\n        { node: null, x: 94.539, y: -573.635 },\n        { node: null, x: 190.994, y: -573.635 },\n        { node: null, x: 290.353, y: -573.635 },\n    ];    //列表中的合集\n\n    start() {\n        this.node.on('clickmj', this.onClickMj, this)\n        this.initMj();\n    }\n\n    onClickMj(event: EventTouch) {\n        console.log('麻将111111 = ', event);\n\n        this.deleteItems(event.target);\n        this.addMjItem(event.target);\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    initMj() {\n        this.randomIndex = this.getRandomMjIndex(1, 37);\n        console.log('开始发牌!!!');\n        for (let i = 0; i < this.allitem; i++) {\n            tween(this.node)\n                .delay(i * 0.1)\n                .call(() => { i == this.allitem - 1 ? this.createMj(true) : this.createMj(false); })\n                .start()\n        }\n    }\n\n    //随机创建麻将\n    createMj(refresh) {\n        //发牌\n        if (this.curitem % 3 == 0) this.randomIndex = this.getRandomMjIndex(1, 37);\n        const spriteFrame = this.mjSpriteAtlas.getSpriteFrame('s_wzmj_' + this.randomIndex);\n        let mj = instantiate(this.mycard_prefab);\n        mj.parent = this.node;\n        var mycard = mj.getComponent(\"mjcard\");\n        this.items.push(mj);\n        var self = this;\n        mycard.initMj(this.randomIndex, spriteFrame, this.level, function () {\n            if (refresh) {\n                self.refreshState();\n                console.log('发牌完毕：', self.curitem);\n                console.log('刷新牌！！！');\n            }\n        });\n        this.curitem += 1;\n    }\n\n    //刷新麻将状态\n    refreshState() {\n        for (let i = 0; i < this.items.length; i++) {\n            let itemsXJ = [];\n            itemsXJ.push(this.items[i]);\n            for (let j = 0; j < this.items.length; j++) {\n                if (this.items[i] != this.items[j]) {\n                    if (this.refreshStateMJ(this.items[i], this.items[j])) {\n                        itemsXJ.push(this.items[j]);\n                    }\n                }\n            }\n            var big = 0;\n            if (itemsXJ.length > 1) {\n                for (let k = 0; k < itemsXJ.length; k++) {\n                    var mjscrpit1 = itemsXJ[k].getComponent(\"mjcard\");\n                    mjscrpit1.interaction = false;\n                    if (itemsXJ[k].getSiblingIndex() > big) {\n                        big = itemsXJ[k].getSiblingIndex();\n                        mjscrpit1.interaction = true;\n                    }\n                    else {\n                        mjscrpit1.interaction = false;\n                    }\n                }\n            }\n        }\n    }\n\n    refreshStateMJ(node1: Node, node2: Node) {\n        // 获取两个节点的边界框的世界坐标位置和大小\n        let pos1 = node1.getPosition();\n        let pos2 = node2.getPosition();\n        // 创建一个临时的矩形对象，用于检测相交\n        // let rect1 = new Rect(pos1.x, pos1.y, 67, 91);\n        // let rect2 = new Rect(pos2.x, pos2.y, 67, 91);\n        let rect1 = new Rect(pos1.x, pos1.y, 90, 120);\n        let rect2 = new Rect(pos2.x, pos2.y, 90, 120);\n        // 判断是否相交\n        if (Intersection2D.rectRect(rect1, rect2)) {\n            //console.log(\"两个图片相交\");\n            return true;\n        }\n        return false;\n    }\n\n    deleteItems(mjNode) {\n        for (let i = 0; i < this.items.length; i++) {\n            if (mjNode.id == this.items[i].id) {\n                this.items.splice(i, 1);\n                console.log('麻将数量：', this.items.length);\n                return;\n            }\n        }\n\n    }\n\n    getRandomInt(min, max) {\n        return Math.floor(Math.random() * (max - min + 1)) + min;\n    }\n\n    getRandomMjIndex(min, max) {\n        var randomInt = this.getRandomInt(1, 37);\n        if (randomInt == 10 || randomInt == 20 || randomInt == 30) randomInt += 1;\n        return randomInt;\n    }\n\n    //添加到物品栏\n    addMjItem(event: Node) {\n        for (let i = 0; i < this.mjItem.length; i++) {\n            if (this.mjItem[i].node == null) {\n                var self = this;\n                let t1 = tween(event).to(0.2, { position: new Vec3(this.mjItem[i].x, this.mjItem[i].y, 0) })\n                let t2 = tween(event).call(() => {\n                    self.mjItem[i].node = event;\n                });\n                tween(event).sequence(t1, t2).start();\n                return;\n            }\n        }\n\n        return;\n    }\n}\n\n"]}