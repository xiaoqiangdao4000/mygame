{"version":3,"sources":["file:///Users/zzx/Desktop/mygame/assets/scripts/mjNode.ts"],"names":["_decorator","Component","instantiate","Intersection2D","Label","Node","Prefab","ProgressBar","Rect","tween","Vec3","tools","gameStart","main","ccclass","property","eventTarget","EventTarget","mjNode","isCanClick","desktopItems","desktopCuritem","randomIndex","desktopItemCount","time","allTime","tabItemPos","x","y","tabItem","start","node","on","onClickMj","startGame","console","log","level","cleanMj","timeLabel","string","timeProgressBar","progress","gameSucNode","active","getInstant","hide","picNum","initDesktopMj","destroyAllChildren","onBtnClick","event","customEventData","gameShowTips","setLevelBtn","show","length","insertItem","insertCallBack","self","deleteDesktopItems","index","isTabCanDelete","refreshDeaktopMj","deleteTabAnima","splice","restTopAnima","update","deltaTime","getRandomMjIndex","delay","i","call","createDesktopMj","countdown","unschedule","refresh","spriteFrame","mjAtlas","getSpriteFrame","mj","mycard_prefab","parent","mycard","getComponent","push","initMj","animType","schedule","itemsXJ","j","pos1","getPosition","pos2","rect1","rect2","rectRect","itemsXJ1","Array","from","Set","maxNodeItem","reduce","a","b","getSiblingIndex","mjscrpit","interaction","desktopScript","cardId","tempIndex","name","callback","t1","to","position","t2","setSiblingIndex","sequence","node2","node1","node0","union","repeat","removeSelf","typeId","spos","epos","gameTipsLabel","setPosition","easing"],"mappings":"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","sourcesContent":["import { _decorator, BoxCollider2D, Collider, Component, ConfigurableConstraint, EventTouch, Input, input, instantiate, Intersection2D, Label, Node, NodeEventType, Prefab, ProgressBar, Rect, resources, Sprite, SpriteAtlas, SpriteFrame, Texture2D, tween, UITransform, Vec2, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\nconst eventTarget = new EventTarget();\nimport tools from './tools'\nimport { gameStart } from './gameStart';\nimport { main } from './main';\n@ccclass('mjNode')\nexport class mjNode extends Component {\n\n    @property(Prefab)\n    mycard_prefab: Prefab | null = null;\n\n    @property(ProgressBar)\n    timeProgressBar: ProgressBar | null = null;\n\n    @property(Label)\n    timeLabel: Label | null = null;\n\n    @property(Node)\n    gameSucNode: Node | null = null;\n\n    @property(Label)\n    gameTipsLabel: Label | null = null;\n\n    isCanClick = false;         //是否可以点击\n    desktopItems = [];          //桌面麻将\n    desktopCuritem = 0;         //当前数量\n    randomIndex = 0;            //当前随机牌索引\n    desktopItemCount = 0;\n    time = 60;\n    allTime = this.time;\n\n    tabItemPos = [\n        { x: -294.764, y: -572 },\n        { x: -197.881, y: -572 },\n        { x: -100.211, y: -572 },\n        { x: -2.572, y: -572 },\n        { x: 94.539, y: -572 },\n        { x: 190.994, y: -572 },\n        { x: 290.353, y: -572 },\n    ];    //物品栏坐标\n\n    tabItem: Node[] = [] //物品栏\n\n    start() {\n        this.node.on('clickmj', this.onClickMj, this);\n        //this.startGame();\n    }\n\n    //开始游戏\n    startGame() {\n        console.log('游戏开始---', tools.level)\n        this.isCanClick = true;\n        this.cleanMj();\n        this.time = tools.level * 10 + 30;\n        this.allTime = this.time;\n        this.timeLabel.string = '第' + tools.level + '关 ' + '倒计时:' + this.time + 's';\n        this.timeProgressBar.progress = this.time / this.allTime;\n        this.gameSucNode.active = false;\n        gameStart.getInstant().hide()\n        this.desktopItemCount = tools.level * tools.picNum;\n        this.initDesktopMj();\n    }\n\n    //清理桌面牌，物品栏\n    cleanMj() {\n        this.node.destroyAllChildren();\n        this.desktopItems = [];\n        this.tabItem = [];\n    }\n\n    //按钮点击事件\n    onBtnClick(event: Event, customEventData: string) {\n        //游戏开始\n        if (customEventData == 'gameStart') {\n            this.startGame();\n        }\n        else if (customEventData == 'contiuneGame') //继续\n        {\n            this.gameShowTips(2);\n            this.startGame();\n        }\n        else if (customEventData == 'backGame')  //返回到开始界面\n        {\n            this.gameShowTips(2);\n            gameStart.getInstant().setLevelBtn();\n            gameStart.getInstant().show();\n        }\n    }\n\n    onClickMj(node: Node) {\n        if (this.isCanClick == false) {\n            console.log('动画为执行完毕，不可点击---');\n            return;\n        }\n        this.isCanClick = false;\n        //是否可以插入\n        if (this.tabItem.length >= 7)  //不可以插入,游戏结束\n        {\n            console.log('格子已经满了---游戏结束');\n            //this.gameShowTips(1);\n            return;\n        }\n        //可以插入\n        this.insertItem(node, insertCallBack);\n\n        //插入回调，删除桌面麻将\n        var self = this;\n        function insertCallBack() {\n            self.deleteDesktopItems(node);\n            //判断物品栏是否可以消除\n            let index = self.isTabCanDelete(node);\n            //console.log('可以消除的下标---', index);\n            if (index.length < 3) {\n                self.refreshDeaktopMj();\n                if (self.tabItem.length == 7) {\n                    self.gameShowTips(0);\n                    console.log('游戏结束---');\n                }\n                self.isCanClick = true;\n                return;\n            }\n            //开始执行物品栏消除动画\n            self.deleteTabAnima(index, function () {\n                self.tabItem.splice(index[2], 1);\n                self.tabItem.splice(index[1], 1);\n                self.tabItem.splice(index[0], 1);\n                self.refreshDeaktopMj();\n                //console.log('消除回调---')\n                self.time += 2;\n                self.restTopAnima()\n            })\n        }\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    initDesktopMj() {\n        this.desktopCuritem = 0;\n        this.randomIndex = tools.getRandomMjIndex(1, 37);\n        console.log('开始发牌---', this.desktopItemCount);\n        for (let i = 0; i < this.desktopItemCount; i++) {\n            tween(this.node)\n                .delay(i * 0.1)\n                .call(() => { i == this.desktopItemCount - 1 ? this.createDesktopMj(true) : this.createDesktopMj(false); })\n                .start()\n        }\n    }\n\n    //倒计时\n    countdown() {\n        if (this.time === 0) {\n            this.unschedule(this.countdown)\n            this.gameShowTips(0);\n        } else {\n            this.time--;\n            this.timeLabel.string = '第' + tools.level + '关 ' + '倒计时:' + this.time + 's';\n            this.timeProgressBar.progress = this.time / this.allTime;\n        }\n    }\n\n    //随机创建麻将\n    createDesktopMj(refresh) {\n        //发牌\n        if (this.desktopCuritem % 3 == 0) this.randomIndex = tools.getRandomMjIndex(1, 37);\n        const spriteFrame = main.getInstant().mjAtlas.getSpriteFrame('s_wzmj_' + this.randomIndex);\n        let mj = instantiate(this.mycard_prefab);\n        mj.parent = this.node;\n        var mycard = mj.getComponent(\"mjcard\");\n        this.desktopItems.push(mj);\n        var self = this;\n        mycard.initMj(this.randomIndex, this.desktopItems.length, spriteFrame, tools.animType, function () {\n            if (refresh) {\n                self.refreshDeaktopMj();\n                console.log('发牌完毕---', self.desktopCuritem);\n                self.schedule(self.countdown, 1)\n            }\n        });\n        this.desktopCuritem += 1;\n    }\n\n    //刷新麻将状态\n    refreshDeaktopMj() {\n        for (let i = 0; i < this.desktopItems.length; i++) {\n            let itemsXJ = [];\n            for (let j = 0; j < this.desktopItems.length; j++) {\n                let pos1 = this.desktopItems[i].getPosition();\n                let pos2 = this.desktopItems[j].getPosition();\n                let rect1 = new Rect(pos1.x, pos1.y, 90, 120);\n                let rect2 = new Rect(pos2.x, pos2.y, 90, 120);\n                if (Intersection2D.rectRect(rect1, rect2)) {\n                    itemsXJ.push(this.desktopItems[j]);\n                }\n            }\n            if (itemsXJ.length < 1) return;\n            //去除数组相同的麻将\n            let itemsXJ1 = Array.from(new Set(itemsXJ));\n            //获取数组最大的麻将\n            let maxNodeItem = itemsXJ1.reduce((a, b) => (a.getSiblingIndex() > b.getSiblingIndex() ? a : b));\n            //设置麻将渲染层级\n            for (let i = 0; i < itemsXJ1.length; i++) {\n                let mjscrpit = itemsXJ1[i].getComponent(\"mjcard\");\n                mjscrpit.interaction = false;\n            }\n            let mjscrpit = maxNodeItem.getComponent(\"mjcard\");\n            mjscrpit.interaction = true;\n        }\n\n    }\n\n    //删除桌面麻将\n    deleteDesktopItems(mjNode) {\n        let mjscrpit = mjNode.getComponent(\"mjcard\");\n        for (let i = 0; i < this.desktopItems.length; i++) {\n            let desktopScript = this.desktopItems[i].getComponent(\"mjcard\");\n            if (mjscrpit.cardId == desktopScript.cardId) {\n                this.desktopItems.splice(i, 1);\n                //console.log('删除桌面成功---', this.desktopItems);\n                return;\n            }\n        }\n\n    }\n\n    //判断是否可以消除,返回消除下标数组\n    isTabCanDelete(node: Node) {\n        let tempIndex = [];\n        //判断否可以消除\n        for (let i = 0; i < this.tabItem.length; i++) {\n            if (this.tabItem[i].name == node.name) {\n                tempIndex.push(i);\n            }\n        }\n        if (tempIndex.length != 3) tempIndex = [];\n        return tempIndex;\n    }\n\n    //插入到物品栏\n    insertItem(node: Node, callback) {\n        this.tabItem.push(node);\n        //console.log('插入成功---');\n        let index = this.tabItem.length - 1;\n        let t1 = tween(node).to(0.2, { position: new Vec3(this.tabItemPos[index].x, this.tabItemPos[index].y, 0) })\n        let t2 = tween(node).call(() => {\n            callback()\n        });\n        node.setSiblingIndex(1000);\n        tween(node).sequence(t1, t2).start()\n    }\n\n    //消除物品栏动画\n    deleteTabAnima(index, callback) {\n        let node2 = this.tabItem[index[2]];\n        let node1 = this.tabItem[index[1]];\n        let node0 = this.tabItem[index[0]];\n        tween(node2)\n            .delay(0.1)\n            .show()\n            .delay(0.1)\n            .hide()\n            .union()\n            .repeat(2)\n            .removeSelf()\n            .start();\n        tween(node1)\n            .delay(0.1)\n            .show()\n            .delay(0.1)\n            .hide()\n            .union()\n            .repeat(2)\n            .removeSelf()\n            .start();\n        tween(node0)\n            .delay(0.1)\n            .show()\n            .delay(0.1)\n            .hide()\n            .union()\n            .repeat(2)\n            .removeSelf()\n            .call(callback())\n            .start();\n    }\n\n    //整理物品栏\n    restTopAnima() {\n        let self = this;\n        if (this.tabItem.length == 0) {\n            self.isCanClick = true;\n        }\n        for (let i = 0; i < this.tabItem.length; i++) {\n            if (i == this.tabItem.length - 1) {\n                tween(this.tabItem[i])\n                    .delay(0.3)\n                    .show()\n                    .to(0.3, { position: new Vec3(this.tabItemPos[i].x, this.tabItemPos[i].y, 0) })\n                    .call(() => {\n                        self.isCanClick = true;\n                    })\n                    .start();\n\n            }\n            else {\n                tween(this.tabItem[i])\n                    .delay(0.3)\n                    .show()\n                    .to(0.3, { position: new Vec3(this.tabItemPos[i].x, this.tabItemPos[i].y, 0) })\n                    .start();\n            }\n        }\n        //成功过关\n        if (this.desktopItems.length == 0) {\n            this.gameShowTips(1);\n        }\n    }\n\n    //显示过关成功，失败，提示 typeId = 0 失败，1成功，\n    gameShowTips(typeId) {\n        this.gameSucNode.active = true;\n        this.unschedule(this.countdown);\n        let spos = new Vec3(-618.507, 125.474, 0);\n        let epos = new Vec3(0, 125.474, 0);\n        if (typeId == 0) //闯关失败\n        {\n            this.gameTipsLabel.string = '闯关失败,再接再厉!';\n            spos = new Vec3(-618.507, 125.474, 0);\n            epos = new Vec3(0, 125.474, 0);\n            this.gameSucNode.setPosition(spos);\n        }\n        if (typeId == 1) // 恭喜,闯关成功\n        {\n            this.gameTipsLabel.string = '恭喜,闯关成功!';\n            spos = new Vec3(-618.507, 125.474, 0);\n            epos = new Vec3(0, 125.474, 0);\n            this.gameSucNode.setPosition(spos);\n            tools.level += 1;       //当前游戏关卡等级\n        }\n        else if (typeId == 2) // 隐藏显示面板\n        {\n            spos = new Vec3(0, 125.474, 0);\n            epos = new Vec3(618.507, 125.474, 0);\n            this.gameSucNode.setPosition(spos);\n        }\n        tween(this.gameSucNode)\n            .to(0.5, { position: epos }, {  // 这里以node的位置信息坐标缓动的目标 \n                easing: \"backIn\",                                   // 缓动函数，可以使用已有的，也可以传入自定义的函数。      \n            })\n            .start();\n    }\n\n}\n\n"]}