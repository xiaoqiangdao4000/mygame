{"version":3,"sources":["file:///C:/Users/zzx/Desktop/mygame/assets/scripts/resMgr.ts"],"names":["resMgr","assetManager","Component","totalAb","nowAb","total","now","abBounds","progressFunc","endFunc","onLoad","Instance","console","log","destroy","loadRes","abBundle","url","typeClass","load","error","asset","loadAssetsInAssetsBundle","resPkg","key","urlSet","urls","assetType","i","length","loadAssetsBundle","abName","loadBundle","err","bundle","preLoadResPkg","unLoadResPkg","preLoadRes","getAsset","bondule","getBundle","get"],"mappings":"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","sourcesContent":["import { _decorator, AssetManager, assetManager, Component } from 'cc';\r\n\r\nexport default class resMgr extends Component {\r\n    static Instance: resMgr = null;\r\n\r\n    private totalAb: number = 0;     //ab包数量\r\n    private nowAb: number = 0;         //当前加载的个数\r\n\r\n    private total: number = 0;       //资源总个数\r\n    private now: number = 0;         //当前加载的个数\r\n\r\n    private abBounds = {};          //保存ab包对应的对象\r\n    private progressFunc: Function = null;\r\n    private endFunc: Function = null;\r\n\r\n    onLoad(): void {\r\n        if (resMgr.Instance === null) {\r\n            console.log('初始化resMgr单列!')\r\n            resMgr.Instance = this;\r\n        }\r\n        else {\r\n            this.destroy();\r\n            return;\r\n        }\r\n    }\r\n\r\n    private loadRes(abBundle: any, url: any, typeClass: any) {\r\n        abBundle.load(url, typeClass, (error: any, asset: any) => {\r\n            this.now++;\r\n            if (error) {\r\n                console.log('load res = ' + url + '--失败:' + error);\r\n            }\r\n            else {\r\n                console.log('load res  = ' + url + '--成功');\r\n            }\r\n            if (this.progressFunc) {\r\n                this.progressFunc(this.now, this.total);\r\n            }\r\n            if (this.now >= this.total) {\r\n                if (this.endFunc != null) this.endFunc();\r\n            }\r\n        })\r\n    }\r\n\r\n    private loadAssetsInAssetsBundle(resPkg: any) {\r\n        for (var key in resPkg) {\r\n            var urlSet = resPkg[key].urls;\r\n            var typeClass = resPkg[key].assetType;\r\n\r\n            for (var i = 0; i < urlSet.length; i++) {\r\n                this.loadRes(this.abBounds[key], urlSet[i], typeClass);\r\n            }\r\n        }\r\n    }\r\n\r\n    private loadAssetsBundle(abName: string, endFunc: Function) {\r\n        assetManager.loadBundle(abName, (err, bundle: AssetManager.Bundle) => {\r\n            if (err != null) {\r\n                console.log('Bundle--load 失败:' + abName);\r\n                this.abBounds[abName] = null;\r\n            }\r\n            else {\r\n                console.log('Bundle--load 成功:' + abName);\r\n                //console.log('Bundle--load 成功:' + bundle);\r\n                this.abBounds[abName] = bundle;\r\n            }\r\n            if (endFunc) {\r\n                endFunc();\r\n            }\r\n        })\r\n    }\r\n\r\n    //预加载资源包\r\n    preLoadResPkg(resPkg: any, progressFunc: Function | null, endFunc: Function) {\r\n        this.totalAb = 0;\r\n        this.nowAb = 0;\r\n        this.total = 0;\r\n        this.now = 0;\r\n        this.progressFunc = progressFunc;\r\n        this.endFunc = endFunc;\r\n\r\n        for (var key in resPkg) {\r\n            this.totalAb++;\r\n            this.total += resPkg[key].urls.length;\r\n        }\r\n\r\n        for (var key in resPkg) {\r\n            this.loadAssetsBundle(key, () => {\r\n                this.nowAb++;\r\n                if (this.nowAb === this.totalAb) {\r\n                    this.loadAssetsInAssetsBundle(resPkg);\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    //释放加载的资源包\r\n    unLoadResPkg() {\r\n\r\n    }\r\n\r\n    //预加载资源\r\n    preLoadRes(abName: string, url: string, progressFunc: Function, endFunc: Function) {\r\n\r\n    }\r\n\r\n    //获取资源\r\n    getAsset(abName: string, url: string) {\r\n        var bondule = assetManager.getBundle(abName);\r\n        if (bondule == null) {\r\n            console.log('err:' + abName + 'ab包加载失败');\r\n            return null;\r\n        }\r\n        return bondule.get(url);\r\n    }\r\n}\r\n\r\n"]}