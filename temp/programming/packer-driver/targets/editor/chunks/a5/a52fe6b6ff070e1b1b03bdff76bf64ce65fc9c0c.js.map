{"version":3,"sources":["file:///C:/Users/zzx/Desktop/mygame/assets/scripts/mjcard.ts"],"names":["_decorator","color","Color","Component","Node","Sprite","SpriteAtlas","tween","Vec3","tools","ccclass","property","mjcard","_interaction","cardId","scale","moveDuration","scaleDuration","sprFrame","cardBackFrame","sPos","ePos","isCanClick","oldSiblingIndex","start","node","on","EventType","TOUCH_START","onTouchStart","interaction","v","normalColor","fromHEX","grayColor","sprite","initMj","num","cardid","animType","callback","name","mjAtlas","getSpriteFrame","cardBackNow","cardBackTotal","rand","getRandomInt","spriteFrame","playAnimation","restCard","restSibingIndex","setSiblingIndex","setInsterEndPos","pos","setCanClick","canClick","setTouShi","spr","addComponent","addChild","x","y","setPosition","setScale","active","self","t1","to","position","t2","t3","parallel","t4","call","getSiblingIndex","sequence","event","console","log","target","parent","emit","update","deltaTime"],"mappings":"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","sourcesContent":["import { _decorator, color, Color, Component, EventTouch, Node, Sprite, SpriteAtlas, SpriteFrame, tween, Vec3 } from 'cc';\r\nimport tools from './tools';\r\nconst { ccclass, property } = _decorator;\r\n@ccclass('mjcard')\r\nexport class mjcard extends Component {\r\n\r\n    @property(Sprite)\r\n    sprite: Sprite = null;\r\n\r\n    @property(SpriteAtlas)\r\n    mjAtlas: SpriteAtlas = null;\r\n\r\n    private _interaction = true;\r\n    cardId = 0;\r\n    scale = 1.5;\r\n    moveDuration = 0.1;\r\n    scaleDuration = 0.1;\r\n    sprFrame: SpriteFrame = null;\r\n    cardBackFrame: SpriteFrame = null;\r\n    sPos: Vec3 = new Vec3(0, 0, 0);\r\n    ePos: Vec3 = new Vec3(0, 0, 0);\r\n    isCanClick = false;\r\n    oldSiblingIndex = 0;\r\n\r\n    start() {\r\n        this.node.on(Node.EventType.TOUCH_START, this.onTouchStart, this);\r\n    }\r\n\r\n    public get interaction() { return this._interaction; }\r\n    public set interaction(v: boolean) {\r\n        this._interaction = v;\r\n        let normalColor = new Color();\r\n        normalColor.fromHEX('#FFFFFF');\r\n        let grayColor = new Color();\r\n        grayColor.fromHEX('#AC8D8D');\r\n        this.sprite.color = v ? normalColor : grayColor;\r\n    }\r\n\r\n    initMj(num, cardid, animType, callback) {\r\n        this.node.name = 'mj_' + num;\r\n        this.cardId = cardid;\r\n        this.sprFrame = this.mjAtlas.getSpriteFrame('mj_' + num);\r\n        if (tools.cardBackNow < tools.cardBackTotal) {\r\n            let rand = tools.getRandomInt(1, 3);\r\n            if (rand == 1) {\r\n                tools.cardBackNow++;\r\n                this.cardBackFrame = this.mjAtlas.getSpriteFrame('mj_35');\r\n                this.sprite.spriteFrame = this.cardBackFrame;\r\n            }\r\n            else {\r\n                this.sprite.spriteFrame = this.sprFrame;\r\n            }\r\n        }\r\n        else {\r\n            this.sprite.spriteFrame = this.sprFrame;\r\n        }\r\n        this.interaction = false;\r\n        this.playAnimation(animType, callback);\r\n    }\r\n\r\n    //恢复到正面牌\r\n    restCard() {\r\n        if (this.cardBackFrame != null) {\r\n            this.sprite.spriteFrame = this.sprFrame;\r\n        }\r\n    }\r\n\r\n    //恢复到之前的渲染层级\r\n    restSibingIndex() {\r\n        this.node.setSiblingIndex(this.oldSiblingIndex);\r\n    }\r\n\r\n    //设置插入后的坐标\r\n    setInsterEndPos(pos: Vec3) {\r\n        this.ePos = pos;\r\n    }\r\n\r\n    //设置麻将牌是否可以点击\r\n    setCanClick(canClick) {\r\n        this.isCanClick = canClick;\r\n    }\r\n\r\n    setTouShi() {\r\n        if (this.cardBackFrame != null) {\r\n            let node = new Node('toushi');\r\n            let spr = node.addComponent(Sprite);\r\n            spr.spriteFrame = this.sprFrame;\r\n            spr.color = color(255, 255, 255, 50);\r\n            this.node.addChild(spr.node);\r\n        }\r\n    }\r\n\r\n    //播放发牌动画\r\n    playAnimation(animType, callback: Function | null) {\r\n        var x = tools.getRandomInt(-300, 300);\r\n        var y = tools.getRandomInt(-200, 400);\r\n        // var x = tools.getRandomInt(-30, 30);\r\n        // var y = tools.getRandomInt(-20, 40);\r\n        this.node.setPosition(0, 0);\r\n        this.node.setScale(0, 0);\r\n        this.node.active = true;\r\n        this.sPos = new Vec3(x, y, 0);//设置桌面坐标\r\n        var self = this;\r\n        //同时移动，缩放\r\n        if (animType == 1) {\r\n            let t1 = tween(this.node).to(this.moveDuration, { position: new Vec3(x, y, 0) })\r\n            let t2 = tween(this.node).to(this.moveDuration, { scale: new Vec3(this.scale, this.scale, 1) })\r\n            let t3 = tween(this.node).parallel(t1, t2);\r\n            let t4 = tween(this.node).call(() => {\r\n                self.isCanClick = true;\r\n                self.oldSiblingIndex = this.node.getSiblingIndex();\r\n                if (callback) callback();\r\n\r\n            });\r\n            tween(this.node).sequence(t3, t4).start();\r\n            //tween(this.node).parallel(t1, t2).start();\r\n            return;\r\n        }\r\n        else if (animType == 2)  //设置位置然后，缩放出现\r\n        {\r\n            this.node.setPosition(x, y);\r\n            let t1 = tween(this.node).to(this.scaleDuration, { scale: new Vec3(this.scale, this.scale, 1) })\r\n            let t2 = tween(this.node).call(() => {\r\n                self.isCanClick = true;\r\n                self.oldSiblingIndex = this.node.getSiblingIndex();\r\n                if (callback) callback();\r\n                // callback();\r\n            });\r\n            tween(this.node).sequence(t1, t2).start();\r\n        }\r\n    }\r\n\r\n    onTouchStart(event: EventTouch) {\r\n        if (this._interaction == false || this.isCanClick == false) {\r\n            console.log('不可点击的麻将 = ', event.target.name);\r\n        }\r\n        else {\r\n            console.log('点击麻将 = ', event.target.name);\r\n            this.node.parent.emit('clickmj', event.target);\r\n        }\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n}\r\n\r\n"]}