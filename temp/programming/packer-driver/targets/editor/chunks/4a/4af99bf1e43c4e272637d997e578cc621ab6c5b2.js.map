{"version":3,"sources":["file:///C:/Users/zzx/Desktop/mygame/assets/scripts/gameLoadingNode.ts"],"names":["_decorator","Component","instantiate","Label","Sprite","tween","tools","resMgr","WECHAT","ccclass","property","gameLoadingNode","loadingSprite","loadingLabel","onLoad","Instance","console","log","destroy","start","startLoad","node","getChildByName","getComponent","fillRange","string","preLoadResPkg","resPkg","loadingResCallBack","delay","call","enterStartScene","now","total","wx","showShareMenu","withShareTicket","menus","hideLoadingNode","prefab","getAsset","parent","active"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Prefab, Sprite, tween } from 'cc';\r\nimport tools from './tools';\r\nimport resMgr from './resMgr';\r\nimport { WECHAT } from 'cc/env';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('gameLoadingNode')\r\nexport class gameLoadingNode extends Component {\r\n    static Instance: gameLoadingNode = null;\r\n\r\n    loadingSprite: Sprite = null;  //进度条\r\n    loadingLabel: Label = null;    //进度条文字\r\n\r\n    onLoad() {\r\n        if (gameLoadingNode.Instance === null) {\r\n            gameLoadingNode.Instance = this;\r\n            console.log('初始化 gameLoadingNode 单列!');\r\n        }\r\n        else {\r\n            this.destroy();\r\n            return;\r\n        }\r\n    }\r\n\r\n    start() {\r\n    }\r\n\r\n    //先加载资源\r\n    startLoad() {\r\n        this.loadingSprite = this.node.getChildByName('loading1').getComponent(Sprite);\r\n        this.loadingLabel = this.node.getChildByName('loadingStr').getComponent(Label);\r\n        this.loadingSprite.fillRange = 0;\r\n        this.loadingLabel.string = '资源加载:开始加载';\r\n\r\n        //加载资源\r\n        resMgr.Instance.preLoadResPkg(tools.resPkg, this.loadingResCallBack, () => {\r\n            //资源加载完成回调\r\n            tween(this.node)\r\n                .delay(0.3)\r\n                .call(() => {\r\n                    gameLoadingNode.Instance.enterStartScene();\r\n                }).start();\r\n\r\n        });\r\n    }\r\n\r\n    //资源加载进度\r\n    loadingResCallBack(now, total) {\r\n        gameLoadingNode.Instance.loadingLabel.string = '资源加载:' + now + '/' + total;\r\n        gameLoadingNode.Instance.loadingSprite.fillRange = now / total;\r\n    }\r\n\r\n    //进入开始界面\r\n    enterStartScene() {\r\n\r\n        if (WECHAT) {\r\n            // @ts-ignore\r\n            wx.showShareMenu({\r\n                withShareTicket: true,\r\n                menus: ['shareAppMessage', 'shareTimeline']\r\n            })\r\n        }\r\n\r\n        //隐藏资源加载界面\r\n        this.hideLoadingNode();\r\n\r\n        //加载开始界面\r\n        let prefab = resMgr.Instance.getAsset('prefabs', 'gameStart') as Prefab;\r\n        let node = instantiate(prefab);\r\n        node.parent = this.node.parent;\r\n\r\n    }\r\n\r\n    //隐藏资源加载界面\r\n    hideLoadingNode() {\r\n        this.node.active = false;\r\n    }\r\n}\r\n\r\n"]}