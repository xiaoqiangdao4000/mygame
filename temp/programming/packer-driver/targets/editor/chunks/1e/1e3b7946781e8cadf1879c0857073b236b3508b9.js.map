{"version":3,"sources":["file:///Users/zzx/Desktop/mygame/assets/scripts/mjNode.ts"],"names":["_decorator","Component","instantiate","Intersection2D","Label","Prefab","ProgressBar","Rect","tween","Vec3","tools","main","ccclass","property","eventTarget","EventTarget","mjNode","refreshLock","desktopItems","desktopCuritem","randomIndex","desktopItemCount","time","allTime","mjItemPos","x","y","mjItem","start","node","on","onClickMj","startGame","level","timeLabel","string","picNum","initDesktopMj","onBtnClick","event","customEventData","console","log","length","gameOver","insertItem","insertCallBack","self","deleteDesktopItems","index","isTabCanDelete","refreshDeaktopMj","deleteTabAnima","splice","restTopAnima","update","deltaTime","getRandomMjIndex","i","delay","call","createDesktopMj","countdown","unschedule","timeProgressBar","progress","refresh","spriteFrame","getInstant","mjAtlas","getSpriteFrame","mj","mycard_prefab","parent","mycard","getComponent","push","initMj","schedule","itemsXJ","j","pos1","getPosition","pos2","rect1","rect2","rectRect","itemsXJ1","Array","from","Set","maxNodeItem","reduce","a","b","getSiblingIndex","mjscrpit","interaction","desktopScript","cardId","tempIndex","name","callback","t1","to","position","t2","setSiblingIndex","sequence","node2","node1","node0","show","hide","union","repeat","removeSelf","nextLevel"],"mappings":"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","sourcesContent":["import { _decorator, BoxCollider2D, Collider, Component, ConfigurableConstraint, EventTouch, Input, input, instantiate, Intersection2D, Label, Node, NodeEventType, Prefab, ProgressBar, Rect, resources, Sprite, SpriteAtlas, SpriteFrame, Texture2D, tween, UITransform, Vec2, Vec3 } from 'cc';\nconst { ccclass, property } = _decorator;\nconst eventTarget = new EventTarget();\nimport tools from './tools'\nimport { gameStart } from './gameStart';\nimport { main } from './main';\n@ccclass('mjNode')\nexport class mjNode extends Component {\n\n    @property(Prefab)\n    mycard_prefab: Prefab | null = null;\n\n    @property(ProgressBar)\n    timeProgressBar: ProgressBar | null = null;\n\n    @property(Label)\n    timeLabel: Label | null = null;\n\n    refreshLock = false;\n    desktopItems = [];          //桌面麻将\n    desktopCuritem = 0;         //当前数量\n    randomIndex = 0;            //当前随机牌索引\n    desktopItemCount = 0;\n    time = 60;\n    allTime = this.time;\n\n    mjItemPos = [\n        { x: -294.764, y: -572 },\n        { x: -197.881, y: -572 },\n        { x: -100.211, y: -572 },\n        { x: -2.572, y: -572 },\n        { x: 94.539, y: -572 },\n        { x: 190.994, y: -572 },\n        { x: 290.353, y: -572 },\n    ];    //物品栏坐标\n\n    mjItem: Node[] = [] //物品栏\n\n    start() {\n        this.node.on('clickmj', this.onClickMj, this);\n        this.startGame();\n    }\n\n    //开始游戏\n    startGame() {\n        this.time = tools.level * 20 + 30;\n        this.allTime = this.time;\n        this.timeLabel.string = '倒计时:' + this.time\n        //gameStart.getInstant().hide()\n        this.desktopItemCount = tools.level * tools.picNum;\n        this.initDesktopMj();\n    }\n\n    //按钮点击事件\n    onBtnClick(event: Event, customEventData: string) {\n        //游戏开始\n        if (customEventData == 'gameStart') {\n            console.log('游戏开始---', tools.level)\n            this.startGame();\n        }\n    }\n\n    onClickMj(node: Node) {\n        //是否可以插入\n        if (this.mjItem.length >= 7)  //不可以插入,游戏结束\n        {\n            console.log('格子已经满了---游戏结束');\n            this.gameOver();\n            return;\n        }\n        //可以插入\n        this.insertItem(node, insertCallBack);\n\n        //插入回调，删除桌面麻将\n        var self = this;\n        function insertCallBack() {\n            self.deleteDesktopItems(node);\n            //判断物品栏是否可以消除\n            let index = self.isTabCanDelete(node);\n            console.log('可以消除的下标---', index);\n            if (index.length < 3) {\n                self.refreshDeaktopMj();\n                if (self.mjItem.length == 7) {\n                    console.log('游戏结束---');\n                }\n                return;\n            }\n            //开始执行物品栏消除动画\n            self.deleteTabAnima(index, function () {\n                self.mjItem.splice(index[2], 1);\n                self.mjItem.splice(index[1], 1);\n                self.mjItem.splice(index[0], 1);\n                self.refreshDeaktopMj();\n                console.log('消除回调---')\n                self.time += 2;\n                self.restTopAnima()\n            })\n        }\n    }\n\n    update(deltaTime: number) {\n\n    }\n\n    initDesktopMj() {\n        this.desktopCuritem = 0;\n        this.randomIndex = tools.getRandomMjIndex(1, 37);\n        console.log('开始发牌---');\n        for (let i = 0; i < this.desktopItemCount; i++) {\n            tween(this.node)\n                .delay(i * 0.1)\n                .call(() => { i == this.desktopItemCount - 1 ? this.createDesktopMj(true) : this.createDesktopMj(false); })\n                .start()\n        }\n    }\n\n    //倒计时\n    countdown() {\n        if (this.time === 0) {\n            this.unschedule(this.countdown)\n            // setTimeout(() => {\n            //     this.warningNode.active = false\n            // }, 1500)\n        } else {\n            this.time--;\n            this.timeLabel.string = '倒计时:' + this.time;\n            this.timeProgressBar.progress = this.time / this.allTime;\n        }\n    }\n\n    //随机创建麻将\n    createDesktopMj(refresh) {\n        //发牌\n        if (this.desktopCuritem % 3 == 0) this.randomIndex = tools.getRandomMjIndex(1, 37);\n        // this.randomIndex += 1;\n        const spriteFrame = main.getInstant().mjAtlas.getSpriteFrame('s_wzmj_' + this.randomIndex);\n        let mj = instantiate(this.mycard_prefab);\n        mj.parent = this.node;\n        var mycard = mj.getComponent(\"mjcard\");\n        this.desktopItems.push(mj);\n        var self = this;\n        mycard.initMj(this.randomIndex, this.desktopItems.length, spriteFrame, tools.level, function () {\n            if (refresh) {\n                self.refreshDeaktopMj();\n                console.log('发牌完毕---', self.desktopCuritem);\n                self.schedule(self.countdown, 1)\n            }\n        });\n        this.desktopCuritem += 1;\n    }\n\n    //刷新麻将状态\n    refreshDeaktopMj() {\n        console.log('刷新牌---', this.desktopItems);\n        for (let i = 0; i < this.desktopItems.length; i++) {\n            let itemsXJ = [];\n            for (let j = 0; j < this.desktopItems.length; j++) {\n                let pos1 = this.desktopItems[i].getPosition();\n                let pos2 = this.desktopItems[j].getPosition();\n                let rect1 = new Rect(pos1.x, pos1.y, 90, 120);\n                let rect2 = new Rect(pos2.x, pos2.y, 90, 120);\n                if (Intersection2D.rectRect(rect1, rect2)) {\n                    itemsXJ.push(this.desktopItems[j]);\n                }\n            }\n            if (itemsXJ.length < 1) return;\n            //去除数组相同的麻将\n            let itemsXJ1 = Array.from(new Set(itemsXJ));\n            //获取数组最大的麻将\n            let maxNodeItem = itemsXJ1.reduce((a, b) => (a.getSiblingIndex() > b.getSiblingIndex() ? a : b));\n            //设置麻将渲染层级\n            for (let i = 0; i < itemsXJ1.length; i++) {\n                let mjscrpit = itemsXJ1[i].getComponent(\"mjcard\");\n                mjscrpit.interaction = false;\n            }\n            let mjscrpit = maxNodeItem.getComponent(\"mjcard\");\n            mjscrpit.interaction = true;\n        }\n\n    }\n\n    //删除桌面麻将\n    deleteDesktopItems(mjNode) {\n        let mjscrpit = mjNode.getComponent(\"mjcard\");\n        for (let i = 0; i < this.desktopItems.length; i++) {\n            let desktopScript = this.desktopItems[i].getComponent(\"mjcard\");\n            if (mjscrpit.cardId == desktopScript.cardId) {\n                this.desktopItems.splice(i, 1);\n                console.log('删除桌面成功---', this.desktopItems);\n                return;\n            }\n        }\n\n    }\n\n    //判断是否可以消除,返回消除下标数组\n    isTabCanDelete(node: Node) {\n        let tempIndex = [];\n        //判断否可以消除\n        for (let i = 0; i < this.mjItem.length; i++) {\n            if (this.mjItem[i].name == node.name) {\n                tempIndex.push(i);\n            }\n        }\n        if (tempIndex.length != 3) tempIndex = [];\n        return tempIndex;\n    }\n\n    //插入到物品栏\n    insertItem(node: Node, callback) {\n        this.mjItem.push(node);\n        console.log('插入成功---');\n        let index = this.mjItem.length - 1;\n        let t1 = tween(node).to(0.2, { position: new Vec3(this.mjItemPos[index].x, this.mjItemPos[index].y, 0) })\n        let t2 = tween(node).call(() => {\n            callback()\n        });\n        node.setSiblingIndex(1000);\n        tween(node).sequence(t1, t2).start()\n    }\n\n    //消除物品栏动画\n    deleteTabAnima(index, callback) {\n        let node2 = this.mjItem[index[2]];\n        let node1 = this.mjItem[index[1]];\n        let node0 = this.mjItem[index[0]];\n        tween(node2)\n            .delay(0.1)\n            .show()\n            .delay(0.1)\n            .hide()\n            .union()\n            .repeat(3)\n            .removeSelf()\n            .start();\n        tween(node1)\n            .delay(0.1)\n            .show()\n            .delay(0.1)\n            .hide()\n            .union()\n            .repeat(3)\n            .removeSelf()\n            .start();\n        tween(node0)\n            .delay(0.1)\n            .show()\n            .delay(0.1)\n            .hide()\n            .union()\n            .repeat(3)\n            .removeSelf()\n            .call(callback())\n            .start();\n    }\n\n    //整理物品栏\n    restTopAnima() {\n        for (let i = 0; i < this.mjItem.length; i++) {\n            tween(this.mjItem[i])\n                .delay(0.5)\n                .show()\n                .to(0.3, { position: new Vec3(this.mjItemPos[i].x, this.mjItemPos[i].y, 0) })\n                .start();\n        }\n\n    }\n\n    //游戏结束\n    gameOver() {\n\n    }\n\n    nextLevel()\n    {\n        \n    }\n}\n\n"]}