{"version":3,"sources":["file:///C:/Users/zzx/Desktop/mygame/assets/scripts/mjNode.ts"],"names":["_decorator","Component","instantiate","Intersection2D","Label","Node","Prefab","ProgressBar","Rect","tween","Vec3","tools","gameStart","main","AudioManager","ccclass","property","eventTarget","EventTarget","mjNode","type","isCanClick","desktopItems","desktopCuritem","randomIndex","desktopItemCount","time","allTime","tabItemPos","tabItem","start","node","on","onClickMj","i","tabNodes","length","pos","x","y","pos1","getPosition","push","startGame","console","log","level","cleanMj","timeLabel","string","timeProgressBar","progress","gameSucNode","active","getInstant","hide","picNum","initDesktopMj","destroyAllChildren","onBtnClick","event","customEventData","inst","playOneShot","instant","btStartMusic","play","btClickMusic","gameShowTips","setLevelBtn","show","insertItem","insertCallBack","self","deleteDesktopItems","index","isTabCanDelete","refreshDeaktopMj","deleteTabAnima","btXiaoChuMusic","splice","restTopAnima","update","deltaTime","getRandomMjIndex","delay","call","createDesktopMj","countdown","unschedule","btTimeMusic","refresh","spriteFrame","mjAtlas","getSpriteFrame","mj","mycard_prefab","parent","mycard","getComponent","initMj","animType","btSendCardMusic","schedule","itemsXJ","j","pos2","rect1","rect2","rectRect","itemsXJ1","Array","from","Set","maxNodeItem","reduce","a","b","getSiblingIndex","mjscrpit","interaction","desktopScript","cardId","tempIndex","name","callback","t1","to","position","t2","setSiblingIndex","sequence","node2","node1","node0","union","repeat","removeSelf","typeId","spos","epos","btGameLostMusic","gameTipsLabel","setPosition","btGameWinMusic","easing"],"mappings":"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","sourcesContent":["import { _decorator, BoxCollider2D, Collider, Component, ConfigurableConstraint, EventTouch, Input, input, instantiate, Intersection2D, Label, Node, NodeEventType, Prefab, ProgressBar, Rect, resources, Sprite, SpriteAtlas, SpriteFrame, Texture2D, tween, UITransform, Vec2, Vec3 } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\nconst eventTarget = new EventTarget();\r\nimport tools from './tools'\r\nimport { gameStart } from './gameStart';\r\nimport { main } from './main';\r\nimport { AudioManager } from './audioManager';\r\n@ccclass('mjNode')\r\nexport class mjNode extends Component {\r\n\r\n    @property(Prefab)\r\n    mycard_prefab: Prefab | null = null;\r\n\r\n    @property(ProgressBar)\r\n    timeProgressBar: ProgressBar | null = null;\r\n\r\n    @property(Label)\r\n    timeLabel: Label | null = null;\r\n\r\n    @property(Node)\r\n    gameSucNode: Node | null = null;\r\n\r\n    @property({\r\n        type: [Node]\r\n    })\r\n    tabNodes: Node[] = [];\r\n\r\n    @property(Label)\r\n    gameTipsLabel: Label | null = null;\r\n\r\n    isCanClick = false;         //是否可以点击\r\n    desktopItems = [];          //桌面麻将\r\n    desktopCuritem = 0;         //当前数量\r\n    randomIndex = 0;            //当前随机牌索引\r\n    desktopItemCount = 0;\r\n    time = 60;\r\n    allTime = this.time;\r\n\r\n    tabItemPos = [];    //物品栏坐标\r\n\r\n    tabItem: Node[] = [] //物品栏\r\n\r\n    start() {\r\n        this.node.on('clickmj', this.onClickMj, this);\r\n        for (let i = 0; i < this.tabNodes.length; i++) {\r\n            let pos = { x: 0, y: 0 };\r\n            let pos1 = this.tabNodes[i].getPosition();\r\n            pos.x = pos1.x;\r\n            pos.y = pos1.y;\r\n            this.tabItemPos.push(pos)\r\n        }\r\n        //this.startGame();\r\n    }\r\n\r\n    //开始游戏\r\n    startGame() {\r\n        console.log('游戏开始---', tools.level)\r\n        this.isCanClick = true;\r\n        this.cleanMj();\r\n        this.time = tools.level * 10 + 30;\r\n        this.allTime = this.time;\r\n        this.timeLabel.string = '第' + tools.level + '关 ' + '倒计时:' + this.time + 's';\r\n        this.timeProgressBar.progress = this.time / this.allTime;\r\n        this.gameSucNode.active = false;\r\n        gameStart.getInstant().hide()\r\n        this.desktopItemCount = tools.level * tools.picNum;\r\n        this.initDesktopMj();\r\n    }\r\n\r\n    //清理桌面牌，物品栏\r\n    cleanMj() {\r\n        this.node.destroyAllChildren();\r\n        this.desktopItems = [];\r\n        this.tabItem = [];\r\n    }\r\n\r\n    //按钮点击事件\r\n    onBtnClick(event: Event, customEventData: string) {\r\n        //游戏开始\r\n        if (customEventData == 'gameStart') {\r\n            //AudioManager.inst.play(main.instant.backMusic);\r\n            AudioManager.inst.playOneShot(main.instant.btStartMusic);\r\n            this.startGame();\r\n        }\r\n        else if (customEventData == 'contiuneGame') //继续\r\n        {\r\n            AudioManager.inst.play(main.instant.btClickMusic);\r\n            this.gameShowTips(2);\r\n            this.startGame();\r\n        }\r\n        else if (customEventData == 'backGame')  //返回到开始界面\r\n        {\r\n            AudioManager.inst.play(main.instant.btClickMusic);\r\n            this.gameShowTips(2);\r\n            gameStart.getInstant().setLevelBtn();\r\n            gameStart.getInstant().show();\r\n        }\r\n    }\r\n\r\n    onClickMj(node: Node) {\r\n        if (this.isCanClick == false) {\r\n            console.log('动画为执行完毕，不可点击---');\r\n            return;\r\n        }\r\n        AudioManager.inst.playOneShot(main.instant.btClickMusic);\r\n\r\n        this.isCanClick = false;\r\n        //是否可以插入\r\n        if (this.tabItem.length >= 7)  //不可以插入,游戏结束\r\n        {\r\n            console.log('格子已经满了---游戏结束');\r\n            //this.gameShowTips(1);\r\n            return;\r\n        }\r\n        //可以插入\r\n        this.insertItem(node, insertCallBack);\r\n\r\n        //插入回调，删除桌面麻将\r\n        var self = this;\r\n        function insertCallBack() {\r\n            self.deleteDesktopItems(node);\r\n            //判断物品栏是否可以消除\r\n            let index = self.isTabCanDelete(node);\r\n            //console.log('可以消除的下标---', index);\r\n            if (index.length < 3) {\r\n                self.refreshDeaktopMj();\r\n                if (self.tabItem.length == 7) {\r\n                    self.gameShowTips(0);\r\n                    console.log('游戏结束---');\r\n                }\r\n                self.isCanClick = true;\r\n                return;\r\n            }\r\n            //开始执行物品栏消除动画\r\n            self.deleteTabAnima(index, function () {\r\n                AudioManager.inst.playOneShot(main.instant.btXiaoChuMusic);\r\n                self.tabItem.splice(index[2], 1);\r\n                self.tabItem.splice(index[1], 1);\r\n                self.tabItem.splice(index[0], 1);\r\n                self.refreshDeaktopMj();\r\n                //console.log('消除回调---')\r\n                self.time += 2;\r\n                self.restTopAnima()\r\n            })\r\n        }\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n\r\n    initDesktopMj() {\r\n        this.desktopCuritem = 0;\r\n        this.randomIndex = tools.getRandomMjIndex();\r\n        console.log('开始发牌---', this.desktopItemCount);\r\n        for (let i = 0; i < this.desktopItemCount; i++) {\r\n            tween(this.node)\r\n                .delay(i * 0.1)\r\n                .call(() => { i == this.desktopItemCount - 1 ? this.createDesktopMj(true) : this.createDesktopMj(false); })\r\n                .start()\r\n        }\r\n    }\r\n\r\n    //倒计时\r\n    countdown() {\r\n        if (this.time === 0) {\r\n            this.unschedule(this.countdown)\r\n            this.gameShowTips(0);\r\n        } else {\r\n            this.time--;\r\n            if (this.time < 10) AudioManager.inst.playOneShot(main.instant.btTimeMusic);\r\n            this.timeLabel.string = '第' + tools.level + '关 ' + '倒计时:' + this.time + 's';\r\n            this.timeProgressBar.progress = this.time / this.allTime;\r\n        }\r\n    }\r\n\r\n    //随机创建麻将\r\n    createDesktopMj(refresh) {\r\n        //发牌\r\n        // AudioManager.inst.playOneShot(main.instant.btSendCardMusic);\r\n        if (this.desktopCuritem % 3 == 0) this.randomIndex = tools.getRandomMjIndex();\r\n        const spriteFrame = main.getInstant().mjAtlas.getSpriteFrame('mj_' + this.randomIndex);\r\n        let mj = instantiate(this.mycard_prefab);\r\n        mj.parent = this.node;\r\n        var mycard = mj.getComponent(\"mjcard\");\r\n        this.desktopItems.push(mj);\r\n        var self = this;\r\n        mycard.initMj(this.randomIndex, this.desktopItems.length, spriteFrame, tools.animType, function () {\r\n            AudioManager.inst.playOneShot(main.instant.btSendCardMusic);\r\n            if (refresh) {\r\n                self.refreshDeaktopMj();\r\n                console.log('发牌完毕---', self.desktopCuritem);\r\n                self.schedule(self.countdown, 1)\r\n            }\r\n        });\r\n        this.desktopCuritem += 1;\r\n    }\r\n\r\n    //刷新麻将状态\r\n    refreshDeaktopMj() {\r\n        for (let i = 0; i < this.desktopItems.length; i++) {\r\n            let itemsXJ = [];\r\n            for (let j = 0; j < this.desktopItems.length; j++) {\r\n                let pos1 = this.desktopItems[i].getPosition();\r\n                let pos2 = this.desktopItems[j].getPosition();\r\n                let rect1 = new Rect(pos1.x, pos1.y, 90, 120);\r\n                let rect2 = new Rect(pos2.x, pos2.y, 90, 120);\r\n                if (Intersection2D.rectRect(rect1, rect2)) {\r\n                    itemsXJ.push(this.desktopItems[j]);\r\n                }\r\n            }\r\n            if (itemsXJ.length < 1) return;\r\n            //去除数组相同的麻将\r\n            let itemsXJ1 = Array.from(new Set(itemsXJ));\r\n            //获取数组最大的麻将\r\n            let maxNodeItem = itemsXJ1.reduce((a, b) => (a.getSiblingIndex() > b.getSiblingIndex() ? a : b));\r\n            //设置麻将渲染层级\r\n            for (let i = 0; i < itemsXJ1.length; i++) {\r\n                let mjscrpit = itemsXJ1[i].getComponent(\"mjcard\");\r\n                mjscrpit.interaction = false;\r\n            }\r\n            let mjscrpit = maxNodeItem.getComponent(\"mjcard\");\r\n            mjscrpit.interaction = true;\r\n        }\r\n\r\n    }\r\n\r\n    //删除桌面麻将\r\n    deleteDesktopItems(mjNode) {\r\n        let mjscrpit = mjNode.getComponent(\"mjcard\");\r\n        for (let i = 0; i < this.desktopItems.length; i++) {\r\n            let desktopScript = this.desktopItems[i].getComponent(\"mjcard\");\r\n            if (mjscrpit.cardId == desktopScript.cardId) {\r\n                this.desktopItems.splice(i, 1);\r\n                //console.log('删除桌面成功---', this.desktopItems);\r\n                return;\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    //判断是否可以消除,返回消除下标数组\r\n    isTabCanDelete(node: Node) {\r\n        let tempIndex = [];\r\n        //判断否可以消除\r\n        for (let i = 0; i < this.tabItem.length; i++) {\r\n            if (this.tabItem[i].name == node.name) {\r\n                tempIndex.push(i);\r\n            }\r\n        }\r\n        if (tempIndex.length != 3) tempIndex = [];\r\n        return tempIndex;\r\n    }\r\n\r\n    //插入到物品栏\r\n    insertItem(node: Node, callback) {\r\n        this.tabItem.push(node);\r\n        //console.log('插入成功---');\r\n        let index = this.tabItem.length - 1;\r\n        let t1 = tween(node).to(0.2, { position: new Vec3(this.tabItemPos[index].x, this.tabItemPos[index].y, 0) })\r\n        let t2 = tween(node).call(() => {\r\n            callback()\r\n        });\r\n        node.setSiblingIndex(1000);\r\n        tween(node).sequence(t1, t2).start()\r\n    }\r\n\r\n    //消除物品栏动画\r\n    deleteTabAnima(index, callback) {\r\n        let node2 = this.tabItem[index[2]];\r\n        let node1 = this.tabItem[index[1]];\r\n        let node0 = this.tabItem[index[0]];\r\n        tween(node2)\r\n            .delay(0.1)\r\n            .show()\r\n            .delay(0.1)\r\n            .hide()\r\n            .union()\r\n            .repeat(2)\r\n            .removeSelf()\r\n            .start();\r\n        tween(node1)\r\n            .delay(0.1)\r\n            .show()\r\n            .delay(0.1)\r\n            .hide()\r\n            .union()\r\n            .repeat(2)\r\n            .removeSelf()\r\n            .start();\r\n        tween(node0)\r\n            .delay(0.1)\r\n            .show()\r\n            .delay(0.1)\r\n            .hide()\r\n            .union()\r\n            .repeat(2)\r\n            .removeSelf()\r\n            .call(callback())\r\n            .start();\r\n    }\r\n\r\n    //整理物品栏\r\n    restTopAnima() {\r\n        let self = this;\r\n        if (this.tabItem.length == 0) {\r\n            self.isCanClick = true;\r\n        }\r\n        for (let i = 0; i < this.tabItem.length; i++) {\r\n            if (i == this.tabItem.length - 1) {\r\n                tween(this.tabItem[i])\r\n                    .delay(0.3)\r\n                    .show()\r\n                    .to(0.3, { position: new Vec3(this.tabItemPos[i].x, this.tabItemPos[i].y, 0) })\r\n                    .call(() => {\r\n                        self.isCanClick = true;\r\n                    })\r\n                    .start();\r\n\r\n            }\r\n            else {\r\n                tween(this.tabItem[i])\r\n                    .delay(0.3)\r\n                    .show()\r\n                    .to(0.3, { position: new Vec3(this.tabItemPos[i].x, this.tabItemPos[i].y, 0) })\r\n                    .start();\r\n            }\r\n        }\r\n        //成功过关\r\n        if (this.desktopItems.length == 0) {\r\n            this.gameShowTips(1);\r\n        }\r\n    }\r\n\r\n    //显示过关成功，失败，提示 typeId = 0 失败，1成功，\r\n    gameShowTips(typeId) {\r\n        this.gameSucNode.active = true;\r\n        this.unschedule(this.countdown);\r\n        let spos = new Vec3(-618.507, 125.474, 0);\r\n        let epos = new Vec3(0, 125.474, 0);\r\n        if (typeId == 0) //闯关失败\r\n        {\r\n            AudioManager.inst.playOneShot(main.instant.btGameLostMusic);\r\n            this.gameTipsLabel.string = '闯关失败,再接再厉!';\r\n            spos = new Vec3(-618.507, 125.474, 0);\r\n            epos = new Vec3(0, 125.474, 0);\r\n            this.gameSucNode.setPosition(spos);\r\n        }\r\n        if (typeId == 1) // 恭喜,闯关成功\r\n        {\r\n            AudioManager.inst.playOneShot(main.instant.btGameWinMusic);\r\n            this.gameTipsLabel.string = '恭喜,闯关成功!';\r\n            spos = new Vec3(-618.507, 125.474, 0);\r\n            epos = new Vec3(0, 125.474, 0);\r\n            this.gameSucNode.setPosition(spos);\r\n            tools.level += 1;       //当前游戏关卡等级\r\n        }\r\n        else if (typeId == 2) // 隐藏显示面板\r\n        {\r\n            spos = new Vec3(0, 125.474, 0);\r\n            epos = new Vec3(618.507, 125.474, 0);\r\n            this.gameSucNode.setPosition(spos);\r\n        }\r\n        tween(this.gameSucNode)\r\n            .to(0.5, { position: epos }, {  // 这里以node的位置信息坐标缓动的目标 \r\n                easing: \"backIn\",                                   // 缓动函数，可以使用已有的，也可以传入自定义的函数。      \r\n            })\r\n            .start();\r\n    }\r\n\r\n}\r\n\r\n"]}