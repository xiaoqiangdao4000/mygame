{"version":3,"sources":["file:///C:/Users/zzx/Desktop/mygame/assets/scripts/mjNode.ts"],"names":["_decorator","Button","color","Component","instantiate","Intersection2D","Label","Node","Prefab","ProgressBar","Rect","Sprite","tween","Vec3","tools","SOUND","gameStart","AudioManager","ccclass","property","eventTarget","EventTarget","mjNode","type","isCanClick","desktopItems","desktopCuritem","randomIndex","desktopItemCount","time","allTime","tabItemPos","tabItem","onLoad","console","log","start","node","on","onClickMj","i","tabNodes","length","pos","x","y","pos1","getPosition","push","startGame","level","cleanMj","timeLabel","string","timeProgressBar","progress","gameSucNode","active","Instance","hide","picNum","cardBackNow","cardBackTotal","randomMjAnim","initDesktopMj","destroyAllChildren","onBtnClick","event","customEventData","playSound","start_sound","click_sound","gameShowTips","setLevel","show","unscheduleAllCallbacks","parent","destroy","xiPai","getChildByName","label","getComponent","enabled","music","inst","stop","insertItem","insertCallBack","self","deleteDesktopItems","index","isTabCanDelete","refreshDeaktopMj","deleteTabAnima","clear_sound","splice","restTopAnima","update","deltaTime","getRandomMjIndex","delay","call","createDesktopMj","countdown","unschedule","time_sound","refresh","mj","mycard_prefab","mycard","initMj","animType","sendCard_sound","schedule","itemsXJ","j","pos2","rect1","rect2","rectRect","itemsXJ1","Array","from","Set","maxNodeItem","reduce","a","b","getSiblingIndex","mjscrpit","interaction","desktopScript","playAnimation","cardId","tempIndex","name","callback","mjcard","restCard","t1","to","position","t2","setSiblingIndex","sequence","node2","node1","node0","union","repeat","removeSelf","typeId","spos","epos","gameLost_sound","gameTipsLabel","setPosition","saveLevel","gameWin_sound","easing"],"mappings":"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","sourcesContent":["import { _decorator, BoxCollider2D, Button, Collider, color, Component, ConfigurableConstraint, EventTouch, Input, input, instantiate, Intersection2D, Label, Node, NodeEventType, Prefab, ProgressBar, Rect, resources, Script, Sprite, SpriteAtlas, SpriteFrame, Texture2D, tween, UITransform, Vec2, Vec3, view } from 'cc';\r\nconst { ccclass, property } = _decorator;\r\nconst eventTarget = new EventTarget();\r\nimport tools, { SOUND } from './tools'\r\nimport { gameStart } from './gameStart';\r\nimport { mjcard } from './mjcard';\r\nimport { AudioManager } from './audioManager';\r\n//import { AudioManager } from './audioManager';\r\n@ccclass('mjNode')\r\nexport class mjNode extends Component {\r\n\r\n    @property(Prefab)\r\n    mycard_prefab: Prefab | null = null;\r\n\r\n    @property(ProgressBar)\r\n    timeProgressBar: ProgressBar | null = null;\r\n\r\n    @property(Label)\r\n    timeLabel: Label | null = null;\r\n\r\n    @property(Node)\r\n    gameSucNode: Node | null = null;\r\n\r\n    @property({\r\n        type: [Node]\r\n    })\r\n    tabNodes: Node[] = [];\r\n\r\n    @property(Label)\r\n    gameTipsLabel: Label | null = null;\r\n\r\n    @property(Node)\r\n    mjFrameNode: Node | null = null;\r\n\r\n    static Instance: mjNode = null;\r\n\r\n    isCanClick = false;         //是否可以点击\r\n    desktopItems = [];          //桌面麻将\r\n    desktopCuritem = 0;         //当前数量\r\n    randomIndex = 0;            //当前随机牌索引\r\n    desktopItemCount = 0;\r\n    time = 60;\r\n    allTime = this.time;\r\n\r\n    tabItemPos = [];    //物品栏坐标\r\n    tabItem: Node[] = [] //物品栏\r\n\r\n    onLoad() {\r\n        console.log('初始化游戏类');\r\n    }\r\n\r\n    start() {\r\n\r\n        this.node.on('clickmj', this.onClickMj, this);\r\n        for (let i = 0; i < this.tabNodes.length; i++) {\r\n            let pos = { x: 0, y: 0 };\r\n            let pos1 = this.tabNodes[i].getPosition();\r\n            pos.x = pos1.x;\r\n            pos.y = pos1.y;\r\n            console.log('posy = ', pos.y)\r\n\r\n            this.tabItemPos.push(pos)\r\n        }\r\n        this.startGame();\r\n    }\r\n\r\n    //开始游戏\r\n    startGame() {\r\n        console.log('游戏开始---', tools.level)\r\n        this.isCanClick = true;\r\n        this.cleanMj();\r\n        this.time = tools.level * 10 + 30;\r\n        this.allTime = this.time;\r\n        this.timeLabel.string = '第' + tools.level + '关 ' + '倒计时:' + this.time + 's';\r\n        this.timeProgressBar.progress = this.time / this.allTime;\r\n        this.gameSucNode.active = false;\r\n        gameStart.Instance.hide()\r\n        this.desktopItemCount = tools.level * tools.picNum;\r\n        tools.cardBackNow = 0;\r\n        tools.cardBackTotal = tools.level;\r\n        tools.randomMjAnim();\r\n        this.initDesktopMj();\r\n    }\r\n\r\n    //清理桌面牌，物品栏\r\n    cleanMj() {\r\n        this.node.destroyAllChildren();\r\n        this.desktopItems = [];\r\n        this.tabItem = [];\r\n    }\r\n\r\n    //按钮点击事件\r\n    onBtnClick(event: Event, customEventData: string) {\r\n        //游戏开始\r\n        if (customEventData == 'gameStart') {\r\n            tools.playSound(SOUND.start_sound);\r\n            this.startGame();\r\n        }\r\n        else if (customEventData == 'contiuneGame') //继续\r\n        {\r\n            tools.playSound(SOUND.click_sound);\r\n            this.gameShowTips(2);\r\n            this.startGame();\r\n        }\r\n        else if (customEventData == 'backGame')  //返回到开始界面\r\n        {\r\n            tools.playSound(SOUND.click_sound);\r\n            // this.gameShowTips(2);\r\n            gameStart.Instance.setLevel(tools.level);\r\n            gameStart.Instance.show();\r\n            this.unscheduleAllCallbacks();\r\n            this.node.parent.destroy();\r\n        }\r\n        else if (customEventData == 'xipai')     //洗牌\r\n        {\r\n            if (tools.xiPai > 0) {\r\n                this.xiPai();\r\n                //  tools.xiPai--;\r\n                let node = this.node.parent.getChildByName('gameXiPaiBtn');\r\n                let label = node.getChildByName('Label').getComponent(Label);\r\n                if (tools.xiPai <= 0) {\r\n                    label.string = '洗牌X0';\r\n                    node.getComponent(Sprite).color = color(255, 255, 255, 128);\r\n                    node.getComponent(Button).enabled = false;\r\n                }\r\n                else {\r\n                    label.string = '洗牌X' + tools.xiPai;\r\n                    node.getComponent(Sprite).color = color(255, 255, 255, 255);\r\n                    node.getComponent(Button).enabled = true;\r\n                }\r\n            }\r\n\r\n        }\r\n        else if (customEventData == 'chehui')     //撤回\r\n        {\r\n\r\n        }\r\n        else if (customEventData == 'addtime')     //加时\r\n        {\r\n\r\n        }\r\n        else if (customEventData == 'toushi')     //透视\r\n        {\r\n\r\n        }\r\n        else if (customEventData == 'music')     //音乐\r\n        {\r\n            if (tools.music) {\r\n                tools.music = false;\r\n                AudioManager.inst.stop();\r\n                let label = this.node.parent.getChildByName('gameMusicBtn').getChildByName('Label').getComponent(Label);\r\n                label.string = '音乐❌'\r\n            }\r\n            else {\r\n                tools.music = true;\r\n                //tools.playSound(SOUND.back_sound);\r\n                let label = this.node.parent.getChildByName('gameMusicBtn').getChildByName('Label').getComponent(Label);\r\n                label.string = '音乐✔'\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    onClickMj(node: Node) {\r\n        if (this.isCanClick == false) {\r\n            console.log('动画为执行完毕，不可点击---');\r\n            return;\r\n        }\r\n        //AudioManager.inst.playOneShot(main.instant.btClickMusic);\r\n        tools.playSound(SOUND.click_sound);\r\n\r\n        this.isCanClick = false;\r\n        //是否可以插入\r\n        if (this.tabItem.length >= 7)  //不可以插入,游戏结束\r\n        {\r\n            console.log('格子已经满了---游戏结束');\r\n            //this.gameShowTips(1);\r\n            return;\r\n        }\r\n        //可以插入\r\n        this.insertItem(node, insertCallBack);\r\n\r\n        //插入回调，删除桌面麻将\r\n        var self = this;\r\n        function insertCallBack() {\r\n            self.deleteDesktopItems(node);\r\n            //判断物品栏是否可以消除\r\n            let index = self.isTabCanDelete(node);\r\n            //console.log('可以消除的下标---', index);\r\n            if (index.length < 3) {\r\n                self.refreshDeaktopMj();\r\n                if (self.tabItem.length == 7) {\r\n                    self.gameShowTips(0);\r\n                    console.log('游戏结束---');\r\n                }\r\n                self.isCanClick = true;\r\n                return;\r\n            }\r\n            //开始执行物品栏消除动画\r\n            self.deleteTabAnima(index, function () {\r\n                //AudioManager.inst.playOneShot(main.instant.btXiaoChuMusic);\r\n                tools.playSound(SOUND.clear_sound);\r\n                self.tabItem.splice(index[2], 1);\r\n                self.tabItem.splice(index[1], 1);\r\n                self.tabItem.splice(index[0], 1);\r\n                self.refreshDeaktopMj();\r\n                //console.log('消除回调---')\r\n                self.time += 2;\r\n                self.restTopAnima()\r\n            })\r\n        }\r\n    }\r\n\r\n    update(deltaTime: number) {\r\n\r\n    }\r\n\r\n    initDesktopMj() {\r\n        this.desktopCuritem = 0;\r\n        this.randomIndex = tools.getRandomMjIndex();\r\n        console.log('开始发牌---', this.desktopItemCount);\r\n        for (let i = 0; i < this.desktopItemCount; i++) {\r\n            // i == this.desktopItemCount - 1 ? this.createDesktopMj(true) : this.createDesktopMj(false);\r\n            tween(this.node)\r\n                .delay(i * 0.04)\r\n                .call(() => { i == this.desktopItemCount - 1 ? this.createDesktopMj(true) : this.createDesktopMj(false); })\r\n                .start()\r\n        }\r\n    }\r\n\r\n    //倒计时\r\n    countdown() {\r\n        if (this.time === 0) {\r\n            this.unschedule(this.countdown)\r\n            this.gameShowTips(0);\r\n        } else {\r\n            this.time--;\r\n            if (this.time < 10) {\r\n                //AudioManager.inst.playOneShot(main.instant.btTimeMusic);\r\n                tools.playSound(SOUND.time_sound);\r\n            }\r\n            this.timeLabel.string = '第' + tools.level + '关 ' + '倒计时:' + this.time + 's';\r\n            this.timeProgressBar.progress = this.time / this.allTime;\r\n        }\r\n    }\r\n\r\n    //随机创建麻将\r\n    createDesktopMj(refresh) {\r\n        //发牌\r\n        if (this.desktopCuritem % 3 == 0) this.randomIndex = tools.getRandomMjIndex();\r\n        let mj = instantiate(this.mycard_prefab);\r\n        mj.parent = this.node;\r\n        var mycard = mj.getComponent(\"mjcard\") as mjcard;\r\n        this.desktopItems.push(mj);\r\n        var self = this;\r\n        mycard.initMj(this.randomIndex, this.desktopItems.length, tools.animType, function () {\r\n            tools.playSound(SOUND.sendCard_sound);\r\n            if (refresh) {\r\n                self.refreshDeaktopMj();\r\n                console.log('发牌完毕---', self.desktopCuritem);\r\n                self.schedule(self.countdown, 1)\r\n            }\r\n        });\r\n        this.desktopCuritem += 1;\r\n    }\r\n\r\n    //刷新麻将状态\r\n    refreshDeaktopMj() {\r\n        for (let i = 0; i < this.desktopItems.length; i++) {\r\n            let itemsXJ = [];\r\n            for (let j = 0; j < this.desktopItems.length; j++) {\r\n                let pos1 = this.desktopItems[i].getPosition();\r\n                let pos2 = this.desktopItems[j].getPosition();\r\n                let rect1 = new Rect(pos1.x, pos1.y, 90, 120);\r\n                let rect2 = new Rect(pos2.x, pos2.y, 90, 120);\r\n                if (Intersection2D.rectRect(rect1, rect2)) {\r\n                    itemsXJ.push(this.desktopItems[j]);\r\n                }\r\n            }\r\n            if (itemsXJ.length < 1) return;\r\n            //去除数组相同的麻将\r\n            let itemsXJ1 = Array.from(new Set(itemsXJ));\r\n            //获取数组最大的麻将\r\n            let maxNodeItem = itemsXJ1.reduce((a, b) => (a.getSiblingIndex() > b.getSiblingIndex() ? a : b));\r\n            //设置麻将渲染层级\r\n            for (let i = 0; i < itemsXJ1.length; i++) {\r\n                let mjscrpit = itemsXJ1[i].getComponent(\"mjcard\");\r\n                mjscrpit.interaction = false;\r\n            }\r\n            let mjscrpit = maxNodeItem.getComponent(\"mjcard\");\r\n            mjscrpit.interaction = true;\r\n        }\r\n    }\r\n\r\n    //洗牌\r\n    xiPai() {\r\n        this.unschedule(this.countdown);\r\n        var self = this;\r\n        for (let i = 0; i < this.desktopItems.length; i++) {\r\n            this.desktopItems[i].active = false;\r\n        }\r\n\r\n        for (let i = 0; i < this.desktopItems.length; i++) {\r\n            let desktopScript = this.desktopItems[i].getComponent(\"mjcard\");\r\n            tween(this.node)\r\n                .delay(i * 0.04)\r\n                .call(() => {\r\n                    tools.playSound(SOUND.sendCard_sound);\r\n                    if (i == this.desktopItems.length - 1) {\r\n                        desktopScript.playAnimation(tools.animType, () => {\r\n                            self.refreshDeaktopMj();\r\n                            console.log('发牌完毕---', self.desktopCuritem);\r\n                            self.schedule(self.countdown, 1)\r\n                        })\r\n                    }\r\n                    else {\r\n                        desktopScript.playAnimation(tools.animType, null);\r\n                    }\r\n                })\r\n                .start()\r\n        }\r\n\r\n        // for (let i = 0; i < this.desktopItems.length; i++) {\r\n        //     let desktopScript = this.desktopItems[i].getComponent(\"mjcard\");\r\n        //     if (i % 5 == 0) tools.playSound(SOUND.sendCard_sound);\r\n        //     var self = this;\r\n        //     if (i == this.desktopItems.length - 1) {\r\n        //         desktopScript.playAnimation(tools.animType, () => {\r\n        //             self.refreshDeaktopMj();\r\n        //             console.log('发牌完毕---', self.desktopCuritem);\r\n        //             self.schedule(self.countdown, 1)\r\n        //         })\r\n        //     }\r\n        //     else {\r\n        //         desktopScript.playAnimation(tools.animType, null);\r\n        //     }\r\n        // }\r\n    }\r\n\r\n    //删除桌面麻将\r\n    deleteDesktopItems(mjNode) {\r\n        let mjscrpit = mjNode.getComponent(\"mjcard\");\r\n        for (let i = 0; i < this.desktopItems.length; i++) {\r\n            let desktopScript = this.desktopItems[i].getComponent(\"mjcard\");\r\n            if (mjscrpit.cardId == desktopScript.cardId) {\r\n                this.desktopItems.splice(i, 1);\r\n                //console.log('删除桌面成功---', this.desktopItems);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    //判断是否可以消除,返回消除下标数组\r\n    isTabCanDelete(node: Node) {\r\n        let tempIndex = [];\r\n        //判断否可以消除\r\n        for (let i = 0; i < this.tabItem.length; i++) {\r\n            if (this.tabItem[i].name == node.name) {\r\n                tempIndex.push(i);\r\n            }\r\n        }\r\n        if (tempIndex.length != 3) tempIndex = [];\r\n        return tempIndex;\r\n    }\r\n\r\n    //插入到物品栏\r\n    insertItem(node: Node, callback) {\r\n\r\n        this.tabItemPos = [];\r\n        for (let i = 0; i < this.tabNodes.length; i++) {\r\n            let pos = { x: 0, y: 0 };\r\n            let pos1 = this.tabNodes[i].getPosition();\r\n            pos.x = pos1.x;\r\n            pos.y = pos1.y;\r\n            console.log('click_posy = ', pos.y)\r\n\r\n            this.tabItemPos.push(pos)\r\n        }\r\n\r\n        let mjcard = node.getComponent('mjcard') as mjcard;\r\n        mjcard.restCard();\r\n        this.tabItem.push(node);\r\n        //console.log('插入成功---');\r\n        let index = this.tabItem.length - 1;\r\n        let t1 = tween(node).to(0.2, { position: new Vec3(this.tabItemPos[index].x, this.tabItemPos[index].y, 0) })\r\n        let t2 = tween(node).call(() => {\r\n            callback()\r\n        });\r\n        node.setSiblingIndex(1000);\r\n        tween(node).sequence(t1, t2).start()\r\n    }\r\n\r\n    //消除物品栏动画\r\n    deleteTabAnima(index, callback) {\r\n        let node2 = this.tabItem[index[2]];\r\n        let node1 = this.tabItem[index[1]];\r\n        let node0 = this.tabItem[index[0]];\r\n        tween(node2)\r\n            .delay(0.1)\r\n            .show()\r\n            .delay(0.1)\r\n            .hide()\r\n            .union()\r\n            .repeat(2)\r\n            .removeSelf()\r\n            .start();\r\n        tween(node1)\r\n            .delay(0.1)\r\n            .show()\r\n            .delay(0.1)\r\n            .hide()\r\n            .union()\r\n            .repeat(2)\r\n            .removeSelf()\r\n            .start();\r\n        tween(node0)\r\n            .delay(0.1)\r\n            .show()\r\n            .delay(0.1)\r\n            .hide()\r\n            .union()\r\n            .repeat(2)\r\n            .removeSelf()\r\n            .call(callback())\r\n            .start();\r\n    }\r\n\r\n    //整理物品栏\r\n    restTopAnima() {\r\n        let self = this;\r\n        if (this.tabItem.length == 0) {\r\n            self.isCanClick = true;\r\n        }\r\n        for (let i = 0; i < this.tabItem.length; i++) {\r\n            if (i == this.tabItem.length - 1) {\r\n                tween(this.tabItem[i])\r\n                    .delay(0.3)\r\n                    .show()\r\n                    .to(0.3, { position: new Vec3(this.tabItemPos[i].x, this.tabItemPos[i].y, 0) })\r\n                    .call(() => {\r\n                        self.isCanClick = true;\r\n                    })\r\n                    .start();\r\n\r\n            }\r\n            else {\r\n                tween(this.tabItem[i])\r\n                    .delay(0.3)\r\n                    .show()\r\n                    .to(0.3, { position: new Vec3(this.tabItemPos[i].x, this.tabItemPos[i].y, 0) })\r\n                    .start();\r\n            }\r\n        }\r\n        //成功过关\r\n        if (this.desktopItems.length == 0) {\r\n            this.gameShowTips(1);\r\n        }\r\n    }\r\n\r\n    //显示过关成功，失败，提示 typeId = 0 失败，1成功，\r\n    gameShowTips(typeId) {\r\n        this.gameSucNode.active = true;\r\n        this.unschedule(this.countdown);\r\n        let spos = new Vec3(-700, 125.474, 0);\r\n        let epos = new Vec3(0, 125.474, 0);\r\n        if (typeId == 0) //闯关失败\r\n        {\r\n            tools.playSound(SOUND.gameLost_sound);\r\n            //AudioManager.inst.playOneShot(main.instant.btGameLostMusic);\r\n            this.gameSucNode.active = true;\r\n            this.gameTipsLabel.string = '闯关失败,再接再厉!';\r\n            spos = new Vec3(-700, 125.474, 0);\r\n            epos = new Vec3(0, 125.474, 0);\r\n            this.gameSucNode.setPosition(spos);\r\n            tools.saveLevel();\r\n        }\r\n        if (typeId == 1) // 恭喜,闯关成功\r\n        {\r\n            tools.playSound(SOUND.gameWin_sound);\r\n            //AudioManager.inst.playOneShot(main.instant.btGameWinMusic);\r\n            this.gameSucNode.active = true;\r\n            this.gameTipsLabel.string = '恭喜,闯关成功!';\r\n            spos = new Vec3(-700, 125.474, 0);\r\n            epos = new Vec3(0, 125.474, 0);\r\n            this.gameSucNode.setPosition(spos);\r\n            tools.level += 1;       //当前游戏关卡等级\r\n            tools.saveLevel();\r\n        }\r\n        else if (typeId == 2) // 隐藏显示面板\r\n        {\r\n            this.gameSucNode.active = false;\r\n            return;\r\n        }\r\n        tween(this.gameSucNode)\r\n            .to(0.5, { position: epos }, {  // 这里以node的位置信息坐标缓动的目标 \r\n                easing: \"quartIn\",          // 缓动函数，可以使用已有的，也可以传入自定义的函数。      \r\n            })\r\n            .start();\r\n    }\r\n\r\n}\r\n\r\n"]}